<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>DIGIY LOC PRO ‚Äî Gestion Location</title>
  
  <!-- SUPABASE -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- GUARD INLINE -->
  <script>
    (function() {
      'use strict';
      const SUPABASE_CONFIG = {
        url: "https://wesqmwjjtsefyjnluosj.supabase.co",
        key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Indlc3Ftd2pqdHNlZnlqbmx1b3NqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNzg4ODIsImV4cCI6MjA4MDc1NDg4Mn0.dZfYOc2iL2_wRYL3zExZFsFSBK6AbMeOid2LrIjcTdA"
      };
      const sb = window.supabase.createClient(SUPABASE_CONFIG.url, SUPABASE_CONFIG.key);
      
      async function guardOrPay(moduleCode, loginPath) {
        let phone = localStorage.getItem('digiy_auth_phone') || sessionStorage.getItem('digiy_auth_phone');
        if (!phone) {
          window.location.href = loginPath;
          return false;
        }
        const { data, error } = await sb.from('digiy_subscriptions').select('*').eq('phone', phone).eq('module', moduleCode).eq('status', 'active').gt('current_period_end', new Date().toISOString()).single();
        if (error || !data) {
          window.location.href = loginPath;
          return false;
        }
        return true;
      }
      
      window.DIGIY = {
        guardOrPay: guardOrPay,
        getPhone: () => localStorage.getItem('digiy_auth_phone') || sessionStorage.getItem('digiy_auth_phone')
      };
    })();
  </script>
  
  <style>
    :root{
      --bg:#061b14;
      --bg2:#0a2820;
      --card:#052e16;
      --accent:#facc15;
      --success:#22c55e;
      --danger:#ef4444;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --border:rgba(148,163,184,0.2);
    }
    
    *{box-sizing:border-box;margin:0;padding:0}
    
    body{
      margin:0;
      font-family:system-ui,sans-serif;
      background:linear-gradient(135deg,var(--bg),var(--bg2));
      color:var(--text);
      min-height:100vh;
    }
    
    #guard_status{
      position:fixed;
      top:20px;
      right:20px;
      padding:12px 20px;
      background:rgba(0,0,0,0.9);
      color:white;
      border-radius:10px;
      font-weight:700;
      font-size:14px;
      z-index:9999;
      border:1px solid rgba(255,255,255,0.1);
    }
    
    .app{display:none}
    html.access-ok .app{display:block}
    
    .container{max-width:1400px;margin:0 auto;padding:1rem}
    
    .header{
      background:rgba(255,255,255,0.05);
      backdrop-filter:blur(20px);
      padding:1.5rem;
      border-radius:16px;
      margin-bottom:1.5rem;
      border:1px solid var(--border);
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap:wrap;
      gap:1rem;
    }
    
    .header h1{
      font-size:1.8rem;
      margin:0;
      background:linear-gradient(135deg,#10b981,#06d6a0);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    
    .header-actions{
      display:flex;
      gap:0.5rem;
      flex-wrap:wrap;
    }
    
    .tabs{
      display:flex;
      gap:0.5rem;
      margin-bottom:1.5rem;
      overflow-x:auto;
      padding-bottom:0.5rem;
    }
    
    .tab{
      padding:0.75rem 1.5rem;
      background:rgba(255,255,255,0.05);
      border:1px solid var(--border);
      border-radius:12px;
      cursor:pointer;
      transition:all 0.2s;
      white-space:nowrap;
      font-weight:600;
      font-size:0.9rem;
    }
    
    .tab:hover{
      background:rgba(255,255,255,0.1);
      border-color:var(--accent);
    }
    
    .tab.active{
      background:var(--accent);
      color:#000;
      border-color:var(--accent);
    }
    
    .content{display:none}
    .content.active{display:block}
    
    .card{
      background:rgba(255,255,255,0.05);
      backdrop-filter:blur(20px);
      border:1px solid var(--border);
      border-radius:16px;
      padding:1.5rem;
      margin-bottom:1rem;
    }
    
    .card h2{
      font-size:1.3rem;
      margin:0 0 1rem;
      color:var(--accent);
    }
    
    .stats-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:1rem;
      margin-bottom:1.5rem;
    }
    
    .stat-card{
      background:rgba(255,255,255,0.05);
      padding:1.5rem;
      border-radius:12px;
      border:1px solid var(--border);
    }
    
    .stat-label{
      font-size:0.85rem;
      color:var(--muted);
      margin-bottom:0.5rem;
      font-weight:600;
      text-transform:uppercase;
    }
    
    .stat-value{
      font-size:2rem;
      font-weight:900;
      color:var(--accent);
    }
    
    .btn{
      padding:0.75rem 1.5rem;
      border:none;
      border-radius:10px;
      font-size:0.9rem;
      font-weight:700;
      cursor:pointer;
      transition:all 0.2s;
      display:inline-flex;
      align-items:center;
      gap:0.5rem;
    }
    
    .btn-primary{
      background:var(--accent);
      color:#000;
    }
    
    .btn-primary:hover{
      transform:translateY(-2px);
      box-shadow:0 8px 16px rgba(250,204,21,0.3);
    }
    
    .btn-success{background:var(--success);color:#fff}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-secondary{
      background:rgba(255,255,255,0.1);
      color:var(--text);
      border:1px solid var(--border);
    }
    
    table{width:100%;border-collapse:collapse}
    th,td{padding:1rem;text-align:left;border-bottom:1px solid var(--border)}
    th{font-size:0.85rem;color:var(--muted);font-weight:700;text-transform:uppercase}
    td{font-size:0.95rem}
    tr:hover{background:rgba(255,255,255,0.05)}
    
    .logement-card{
      background:rgba(255,255,255,0.05);
      border:1px solid var(--border);
      border-radius:12px;
      padding:1.5rem;
      margin-bottom:1rem;
      display:grid;
      grid-template-columns:200px 1fr auto;
      gap:1.5rem;
      align-items:start;
    }
    
    .logement-img{
      width:200px;
      height:150px;
      object-fit:cover;
      border-radius:8px;
      background:rgba(255,255,255,0.1);
    }
    
    .logement-info h3{
      margin:0 0 0.5rem;
      color:var(--accent);
      font-size:1.2rem;
    }
    
    .logement-info p{
      margin:0.25rem 0;
      color:var(--muted);
      font-size:0.9rem;
    }
    
    .logement-actions{
      display:flex;
      flex-direction:column;
      gap:0.5rem;
    }
    
    .badge{
      display:inline-block;
      padding:0.25rem 0.75rem;
      border-radius:6px;
      font-size:0.75rem;
      font-weight:700;
    }
    
    .badge-success{
      background:rgba(34,197,94,0.2);
      color:var(--success);
    }
    
    @media(max-width:768px){
      .container{padding:0.5rem}
      .header{padding:1rem}
      .header h1{font-size:1.3rem}
      .stats-grid{grid-template-columns:1fr}
      .logement-card{grid-template-columns:1fr;gap:1rem}
      .logement-img{width:100%;height:200px}
      table{font-size:0.85rem}
      th,td{padding:0.5rem}
    }
  </style>
</head>
<body>

<div id="guard_status">üîê V√©rification...</div>

<div class="app">
  <div class="container">
    <!-- HEADER -->
    <div class="header">
      <div>
        <h1>üè† DIGIY LOC PRO</h1>
        <p style="margin:0.5rem 0 0;color:var(--muted);font-size:0.9rem">
          <span id="userName">Jean Baptiste Beauville</span> ¬∑ 
          <span id="userPhone">+221 77 134 28 89</span>
        </p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" onclick="alert('Fonctionnalit√© √† venir')">
          ‚ûï Ajouter un logement
        </button>
        <button class="btn btn-secondary" onclick="logout()">
          üö™ D√©connexion
        </button>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('dashboard')">üìä Dashboard</div>
      <div class="tab" onclick="switchTab('logements')">üè† Mes logements</div>
      <div class="tab" onclick="switchTab('reservations')">üìÖ R√©servations</div>
      <div class="tab" onclick="switchTab('calendrier')">üìÜ Calendrier</div>
    </div>

    <!-- DASHBOARD -->
    <div id="dashboard" class="content active">
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Revenus ce mois</div>
          <div class="stat-value">0 F</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Taux d'occupation</div>
          <div class="stat-value">0%</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">R√©servations actives</div>
          <div class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Logements actifs</div>
          <div class="stat-value">1</div>
        </div>
      </div>

      <div class="card">
        <h2>üìÖ Prochaines arriv√©es</h2>
        <p style="color:var(--muted)">Aucune r√©servation √† venir</p>
      </div>
    </div>

    <!-- LOGEMENTS -->
    <div id="logements" class="content">
      <div class="card">
        <h2>üè† Mes logements</h2>
        
        <div class="logement-card">
          <img src="https://via.placeholder.com/200x150?text=CHEZ+BAPTISTE" alt="CHEZ BAPTISTE" class="logement-img">
          <div class="logement-info">
            <h3>CHEZ BAPTISTE</h3>
            <p>üìç Saly, S√©n√©gal</p>
            <p>üë• 4 personnes max</p>
            <p>Quartier calme ¬∑ S√©n√©lec en sus ¬∑ R√©servation directe</p>
            <p style="margin-top:0.5rem">
              <strong>Tarifs:</strong><br>
              Nuit: 30,000 F ¬∑ Semaine: 175,000 F ¬∑ Mois: 550,000 F
            </p>
            <p style="margin-top:0.5rem">
              <span class="badge badge-success">‚úÖ Actif</span>
            </p>
          </div>
          <div class="logement-actions">
            <button class="btn btn-secondary" onclick="alert('Fonctionnalit√© √† venir')">‚úèÔ∏è Modifier</button>
            <button class="btn btn-secondary" onclick="alert('Fonctionnalit√© √† venir')">üìÖ Calendrier</button>
            <button class="btn btn-secondary" onclick="window.open('https://wa.me/221771342889', '_blank')">üí¨ WhatsApp</button>
          </div>
        </div>
      </div>
    </div>

    <!-- R√âSERVATIONS -->
    <div id="reservations" class="content">
      <div class="card">
        <h2>üìÖ Toutes les r√©servations</h2>
        <table>
          <thead>
            <tr>
              <th>Client</th>
              <th>Logement</th>
              <th>Dates</th>
              <th>Montant</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="5" style="text-align:center;color:var(--muted)">Aucune r√©servation</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- CALENDRIER -->
    <div id="calendrier" class="content">
      <div class="card">
        <h2>üìÜ Calendrier de disponibilit√©</h2>
        <p style="color:var(--muted)">Calendrier √† venir...</p>
      </div>
    </div>
  </div>
</div>

<script>
(async () => {
  if (!window.DIGIY) {
    alert('Erreur. Rafra√Æchissez.');
    return;
  }
  
  const ok = await window.DIGIY.guardOrPay("LOC", "./login.html");
  if (!ok) return;
  
  document.documentElement.classList.add('access-ok');
  
  const phone = window.DIGIY.getPhone();
  if (phone) {
    document.getElementById('userPhone').textContent = phone;
  }
  
  setTimeout(() => {
    document.getElementById('guard_status').style.display = 'none';
  }, 1200);
})();

function switchTab(tabName) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
  
  event.target.classList.add('active');
  document.getElementById(tabName).classList.add('active');
}

function logout() {
  if (confirm('Se d√©connecter ?')) {
    localStorage.removeItem('digiy_auth_phone');
    sessionStorage.removeItem('digiy_auth_phone');
    window.location.href = 'login.html';
  }
}
</script>

</body>
</html>
