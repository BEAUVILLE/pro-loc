<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b2a1f"/>
  <title>DIGIY LOC â€” Listing du Jour</title>

  <style>
    :root{
      --bg:#061b14;
      --card:#0b2a1f;
      --card2:#0a241b;
      --line:rgba(255,255,255,.12);
      --text:#eafff1;
      --muted:rgba(234,255,241,.72);
      --gold:#facc15;
      --green:#22c55e;
      --orange:#f59e0b;
      --blue:#38bdf8;
      --bad:#ef4444;
      --radius:18px;
      --shadow:0 18px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(34,197,94,.22), transparent 55%),
        radial-gradient(800px 520px at 90% 10%, rgba(250,204,21,.16), transparent 50%),
        linear-gradient(180deg, #03120d, var(--bg));
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      -webkit-font-smoothing:antialiased;
      padding:16px 14px 90px;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:520px;margin:0 auto}
    .topbar{
      position:sticky; top:0; z-index:30;
      padding:10px 0 12px;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(3,18,13,.92), rgba(3,18,13,.55));
      border-bottom:1px solid rgba(255,255,255,.06);
      margin:-16px -14px 12px;
      padding-left:14px; padding-right:14px;
    }
    .brand{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand .left{
      display:flex; align-items:center; gap:10px;
      min-width:0;
    }
    .logo{
      width:38px;height:38px;border-radius:14px;
      background: linear-gradient(135deg, rgba(34,197,94,.25), rgba(250,204,21,.18));
      border:1px solid rgba(250,204,21,.25);
      box-shadow: 0 14px 28px rgba(0,0,0,.35);
      display:grid; place-items:center;
      font-weight:900; letter-spacing:.5px;
      color:var(--gold);
      flex:0 0 auto;
    }
    .titlebox{min-width:0}
    .title{
      font-size:15px; font-weight:800; line-height:1.1;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .subtitle{
      font-size:12px; color:var(--muted);
      margin-top:2px;
    }
    .chip{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(11,42,31,.55);
      color:var(--muted);
      display:flex; gap:8px; align-items:center;
      flex:0 0 auto;
    }
    .dot{width:8px;height:8px;border-radius:99px;background:var(--green); box-shadow:0 0 0 4px rgba(34,197,94,.15)}
    .hero{
      background: linear-gradient(180deg, rgba(11,42,31,.9), rgba(11,42,31,.65));
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      padding:14px;
      box-shadow: var(--shadow);
    }
    .heroTop{
      display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
    }
    .h1{
      font-size:16px; font-weight:900; letter-spacing:.2px;
      margin:0;
    }
    .h2{
      font-size:12px; margin:6px 0 0; color:var(--muted); line-height:1.35;
    }
    .kpis{
      display:grid; grid-template-columns:repeat(3, 1fr);
      gap:10px; margin-top:12px;
    }
    .kpi{
      background: rgba(10,36,27,.7);
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      padding:10px;
    }
    .kpi .n{font-size:18px;font-weight:900}
    .kpi .l{font-size:11px;color:var(--muted); margin-top:2px}
    .tabs{
      display:flex; gap:10px; margin:14px 0 10px;
      position:sticky; top:76px; z-index:25;
      padding:10px 0;
      background: linear-gradient(180deg, rgba(6,27,20,.98), rgba(6,27,20,.55));
      backdrop-filter: blur(10px);
    }
    .tab{
      flex:1;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(11,42,31,.5);
      padding:10px 12px;
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; justify-content:center;
      gap:8px;
      user-select:none;
    }
    .tab strong{color:var(--text); font-weight:900}
    .tab.active{
      background: linear-gradient(135deg, rgba(34,197,94,.20), rgba(250,204,21,.14));
      border-color: rgba(250,204,21,.25);
      color:var(--text);
    }
    .pill{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      color:var(--muted);
      background: rgba(0,0,0,.18);
    }
    .section{ margin-top:8px; }
    .sectionHead{
      display:flex; align-items:center; justify-content:space-between;
      margin:10px 2px 10px;
    }
    .sectionHead h3{
      margin:0;
      font-size:13px;
      letter-spacing:.2px;
      font-weight:900;
    }
    .sectionHead .small{ font-size:12px; color:var(--muted); }

    .card{
      background: linear-gradient(180deg, rgba(11,42,31,.92), rgba(11,42,31,.70));
      border:1px solid rgba(255,255,255,.10);
      border-radius:22px;
      padding:12px;
      box-shadow: 0 14px 28px rgba(0,0,0,.28);
      margin-bottom:10px;
    }
    .row{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    .main{ min-width:0; }
    .name{
      font-size:14px; font-weight:900;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .meta{
      margin-top:6px;
      display:flex; flex-wrap:wrap; gap:8px;
      color:var(--muted);
      font-size:12px;
    }
    .tag{
      display:inline-flex; align-items:center; gap:7px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
      line-height:1;
    }
    .ic{ width:9px;height:9px;border-radius:99px; background: rgba(255,255,255,.20); }
    .ic.green{background:var(--green); box-shadow:0 0 0 4px rgba(34,197,94,.14)}
    .ic.orange{background:var(--orange); box-shadow:0 0 0 4px rgba(245,158,11,.14)}
    .ic.blue{background:var(--blue); box-shadow:0 0 0 4px rgba(56,189,248,.14)}
    .ic.bad{background:var(--bad); box-shadow:0 0 0 4px rgba(239,68,68,.12)}
    .status{
      font-size:11px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      color:var(--muted);
      white-space:nowrap;
    }

    .actions{
      display:flex; gap:10px;
      margin-top:10px;
    }
    .btn{
      flex:1;
      border:none;
      border-radius:16px;
      padding:11px 12px;
      font-size:12px;
      font-weight:900;
      cursor:pointer;
      color:var(--text);
      background: rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
      display:flex; align-items:center; justify-content:center; gap:8px;
    }
    .btn:active{transform:translateY(1px)}
    .btn.whatsapp{
      background: rgba(34,197,94,.16);
      border-color: rgba(34,197,94,.25);
    }
    .btn.call{
      background: rgba(250,204,21,.12);
      border-color: rgba(250,204,21,.25);
      color: var(--text);
    }
    .btn.ok{
      background: rgba(56,189,248,.14);
      border-color: rgba(56,189,248,.25);
    }

    .empty{
      padding:18px 14px;
      text-align:center;
      color:var(--muted);
      border:1px dashed rgba(255,255,255,.16);
      border-radius:18px;
      background: rgba(0,0,0,.12);
    }

    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:16px; z-index:50;
      width:min(520px, calc(100vw - 28px));
      background: rgba(11,42,31,.92);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      padding:12px 12px;
      display:none;
      gap:10px;
      align-items:center;
    }
    .toast .t{font-size:12px;color:var(--muted)}
    .toast .b{
      margin-left:auto;
      font-size:12px;
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      color:var(--text);
      font-weight:900;
    }

    .safe{ height: env(safe-area-inset-bottom); }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="brand">
        <div class="left">
          <div class="logo">D</div>
          <div class="titlebox">
            <div class="title">DIGIY LOC â€” Listing du Jour</div>
            <div class="subtitle" id="todayLabel">â€”</div>
          </div>
        </div>
        <div class="chip" title="Ã‰tat rÃ©seau">
          <span class="dot" id="netDot"></span>
          <span id="netLabel">En ligne</span>
        </div>
      </div>
    </div>

    <div class="hero">
      <div class="heroTop">
        <div>
          <p class="h1">Tableau du jour (PropriÃ©taire)</p>
          <p class="h2">ArrivÃ©es, dÃ©parts, prÃ©sents. Lisible en 5 secondes. Boutons WhatsApp / Appel.</p>
        </div>
        <div class="pill" id="businessCode">CODE â€¢ â€”</div>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="n" id="kpiArr">0</div>
          <div class="l">ArrivÃ©es</div>
        </div>
        <div class="kpi">
          <div class="n" id="kpiDep">0</div>
          <div class="l">DÃ©parts</div>
        </div>
        <div class="kpi">
          <div class="n" id="kpiOcc">0</div>
          <div class="l">En cours</div>
        </div>
      </div>
    </div>

    <div class="tabs" role="tablist" aria-label="Listing du jour">
      <div class="tab active" id="tab-arr" role="tab" aria-selected="true" tabindex="0" data-tab="arr">
        ðŸŸ¢ <strong>ArrivÃ©es</strong> <span class="pill" id="countArr">0</span>
      </div>
      <div class="tab" id="tab-dep" role="tab" aria-selected="false" tabindex="-1" data-tab="dep">
        ðŸŸ  <strong>DÃ©parts</strong> <span class="pill" id="countDep">0</span>
      </div>
      <div class="tab" id="tab-occ" role="tab" aria-selected="false" tabindex="-1" data-tab="occ">
        ðŸ”µ <strong>En cours</strong> <span class="pill" id="countOcc">0</span>
      </div>
    </div>

    <div class="section" id="panel-arr" role="tabpanel" aria-labelledby="tab-arr"></div>
    <div class="section" id="panel-dep" role="tabpanel" aria-labelledby="tab-dep" style="display:none"></div>
    <div class="section" id="panel-occ" role="tabpanel" aria-labelledby="tab-occ" style="display:none"></div>

    <div class="safe"></div>
  </div>

  <div class="toast" id="toast">
    <div class="t" id="toastText">â€”</div>
    <button class="b" id="toastBtn">OK</button>
  </div>

  <script>
    // =============================
    // DEMO DATA (remplacÃ© ensuite par Supabase)
    // =============================
    const DEMO = {
      business_code: "BEAUVILLE",
      arrivals: [
        { guest_name:"Awa Ndiaye", room_label:"Chambre 2", phone:"+221771234567", eta:"14:30", source:"Direct", status:"ConfirmÃ©e" },
        { guest_name:"Mamadou Diallo", room_label:"Villa A", phone:"+221781112233", eta:"18:00", source:"WhatsApp", status:"Ã€ venir" }
      ],
      departures: [
        { guest_name:"Fatou Sarr", room_label:"Chambre 1", phone:"+221701234000", time:"11:00", housekeeping:"Ã€ faire", status:"DÃ©part" }
      ],
      occupied: [
        { guest_name:"Ibrahima Ba", room_label:"Chambre 3", phone:"+221763330000", from:"2026-01-10", to:"2026-01-13", status:"En cours" }
      ]
    };

    const $ = (id)=>document.getElementById(id);

    function fmtDateFR(d){
      return d.toLocaleDateString("fr-FR", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
    }

    function waLink(phone, message){
      const p = (phone||"").replace(/[^\d]/g,"");
      const text = encodeURIComponent(message||"Bonjour ðŸ‘‹");
      return `https://wa.me/${p}?text=${text}`;
    }

    function telLink(phone){
      return `tel:${phone||""}`;
    }

    function toast(msg){
      const t = $("toast");
      $("toastText").textContent = msg;
      t.style.display = "flex";
      window.clearTimeout(window.__toastTimer);
      window.__toastTimer = window.setTimeout(()=> t.style.display="none", 2500);
    }

    $("toastBtn").addEventListener("click", ()=> $("toast").style.display="none");

    function refreshNetwork(){
      const on = navigator.onLine;
      $("netLabel").textContent = on ? "En ligne" : "Hors ligne";
      $("netDot").style.background = on ? "var(--green)" : "var(--bad)";
    }
    window.addEventListener("online", refreshNetwork);
    window.addEventListener("offline", refreshNetwork);

    function sectionHeader(title, subtitle){
      const h = document.createElement("div");
      h.className = "sectionHead";
      h.innerHTML = `<h3>${title}</h3><div class="small">${subtitle||""}</div>`;
      return h;
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function cardArrival(item){
      const msg = `Bonjour ${item.guest_name} ðŸ‘‹\nNous confirmons votre arrivÃ©e aujourd'hui.\nLogement: ${item.room_label}\nÃ€ tout Ã  l'heure.`;
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="row">
          <div class="main">
            <div class="name">${escapeHtml(item.guest_name)}</div>
            <div class="meta">
              <span class="tag"><span class="ic green"></span> ${escapeHtml(item.room_label)}</span>
              <span class="tag"><span class="ic orange"></span> ETA ${escapeHtml(item.eta||"â€”")}</span>
              <span class="tag"><span class="ic blue"></span> ${escapeHtml(item.source||"â€”")}</span>
            </div>
          </div>
          <div class="status">${escapeHtml(item.status||"ArrivÃ©e")}</div>
        </div>
        <div class="actions">
          <a class="btn whatsapp" href="${waLink(item.phone, msg)}" target="_blank" rel="noopener">ðŸ“² WhatsApp</a>
          <a class="btn call" href="${telLink(item.phone)}">ðŸ“ž Appeler</a>
        </div>
      `;
      return el;
    }

    function cardDeparture(item){
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="row">
          <div class="main">
            <div class="name">${escapeHtml(item.guest_name)}</div>
            <div class="meta">
              <span class="tag"><span class="ic orange"></span> ${escapeHtml(item.room_label)}</span>
              <span class="tag"><span class="ic blue"></span> DÃ©part ${escapeHtml(item.time||"â€”")}</span>
              <span class="tag"><span class="ic ${item.housekeeping==="Fait" ? "green":"bad"}"></span> MÃ©nage: ${escapeHtml(item.housekeeping||"â€”")}</span>
            </div>
          </div>
          <div class="status">${escapeHtml(item.status||"DÃ©part")}</div>
        </div>
        <div class="actions">
          <button class="btn ok" data-action="hk">ðŸ§¹ MÃ©nage OK</button>
          <a class="btn call" href="${telLink(item.phone)}">ðŸ“ž Appeler</a>
        </div>
      `;
      el.querySelector('[data-action="hk"]').addEventListener("click", ()=>{
        item.housekeeping = "Fait";
        toast(`MÃ©nage OK â€¢ ${item.room_label}`);
        renderAll();
      });
      return el;
    }

    function cardOccupied(item){
      const msg = `Bonjour ${item.guest_name} ðŸ‘‹\nTout se passe bien ?\nBesoin d'aide ?`;
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <div class="row">
          <div class="main">
            <div class="name">${escapeHtml(item.guest_name)}</div>
            <div class="meta">
              <span class="tag"><span class="ic blue"></span> ${escapeHtml(item.room_label)}</span>
              <span class="tag"><span class="ic green"></span> ${escapeHtml(item.from)} â†’ ${escapeHtml(item.to)}</span>
            </div>
          </div>
          <div class="status">${escapeHtml(item.status||"En cours")}</div>
        </div>
        <div class="actions">
          <a class="btn whatsapp" href="${waLink(item.phone, msg)}" target="_blank" rel="noopener">ðŸ“² Message</a>
          <a class="btn call" href="${telLink(item.phone)}">ðŸ“ž Appeler</a>
        </div>
      `;
      return el;
    }

    function emptyState(text){
      const el = document.createElement("div");
      el.className = "empty";
      el.textContent = text;
      return el;
    }

    function setTab(key){
      const keys = ["arr","dep","occ"];
      keys.forEach(k=>{
        $("tab-"+k).classList.toggle("active", k===key);
        $("tab-"+k).setAttribute("aria-selected", k===key ? "true":"false");
        $("tab-"+k).setAttribute("tabindex", k===key ? "0":"-1");
        $("panel-"+k).style.display = (k===key) ? "block":"none";
      });
      localStorage.setItem("digiy_loc_listing_tab", key);
    }

    document.querySelectorAll(".tab").forEach(t=>{
      t.addEventListener("click", ()=> setTab(t.dataset.tab));
      t.addEventListener("keydown", (e)=>{
        if(e.key==="Enter" || e.key===" "){ e.preventDefault(); setTab(t.dataset.tab); }
      });
    });

    function renderAll(){
      const d = new Date();
      $("todayLabel").textContent = fmtDateFR(d);
      $("businessCode").textContent = "CODE â€¢ " + DEMO.business_code;

      $("kpiArr").textContent = DEMO.arrivals.length;
      $("kpiDep").textContent = DEMO.departures.length;
      $("kpiOcc").textContent = DEMO.occupied.length;

      $("countArr").textContent = DEMO.arrivals.length;
      $("countDep").textContent = DEMO.departures.length;
      $("countOcc").textContent = DEMO.occupied.length;

      const pArr = $("panel-arr");
      const pDep = $("panel-dep");
      const pOcc = $("panel-occ");
      pArr.innerHTML = ""; pDep.innerHTML = ""; pOcc.innerHTML = "";

      pArr.appendChild(sectionHeader("ArrivÃ©es aujourdâ€™hui", "Contacts rapides WhatsApp / Appel"));
      if(DEMO.arrivals.length===0) pArr.appendChild(emptyState("Aucune arrivÃ©e aujourdâ€™hui."));
      DEMO.arrivals.forEach(x=> pArr.appendChild(cardArrival(x)));

      pDep.appendChild(sectionHeader("DÃ©parts aujourdâ€™hui", "Marque le mÃ©nage comme fait"));
      if(DEMO.departures.length===0) pDep.appendChild(emptyState("Aucun dÃ©part aujourdâ€™hui."));
      DEMO.departures.forEach(x=> pDep.appendChild(cardDeparture(x)));

      pOcc.appendChild(sectionHeader("En cours", "Clients actuellement prÃ©sents"));
      if(DEMO.occupied.length===0) pOcc.appendChild(emptyState("Aucun client en cours."));
      DEMO.occupied.forEach(x=> pOcc.appendChild(cardOccupied(x)));

      refreshNetwork();

      try{
        localStorage.setItem("digiy_loc_listing_cache", JSON.stringify({
          cached_at: new Date().toISOString(),
          data: DEMO
        }));
      }catch(e){}
    }

    (function boot(){
      renderAll();
      const last = localStorage.getItem("digiy_loc_listing_tab") || "arr";
      setTab(["arr","dep","occ"].includes(last) ? last : "arr");
    })();
  </script>
</body>
</html>
